{% extends "base.html.twig" %}
{% block title %}
	Page de :
	{{ product.name }}
{% endblock %}

{% block body %}
	<div class="container mt-4">
		<h1 class="mb-4">{{ product.name }}</h1>
		<div
			class="row">
			<!-- Galerie d'images du produit -->
			<div class="col-lg-8 mb-4">
				<div id="carouselSingleProductIndicators" class="carousel slide carousel-fade">
					<div class="carousel-inner">
						{% for image in product.images %}
							<div class="carousel-item {% if loop.first %}active{% endif %}">
								<img src="{{ vich_uploader_asset(image, 'imageFile') }}" alt="{{ product.name }}" class="img-fluid">
							</div>
						{% endfor %}
					</div>
					<button class="carousel-control-prev" type="button" data-bs-target="#carouselSingleProductIndicators" data-bs-slide="prev">
						<span class="carousel-control-prev-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Previous</span>
					</button>
					<button class="carousel-control-next" type="button" data-bs-target="#carouselSingleProductIndicators" data-bs-slide="next">
						<span class="carousel-control-next-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Next</span>
					</button>
				</div>
			</div>

			<!-- Détails du produit et ajout au panier -->
			<div class="col-lg-4">
				<div class="card mb-4 shadow-sm">
					<div
						class="product-card-details p-3 text-center">
						<!-- Titre du produit -->
						<h5 class="product-title fs-5 mb-3" style="max-width: 250px; margin: auto;">{{ product.name }}</h5>

						<!-- Prix du produit -->
						<p class="product-price mb-3">
							<span class="fw-bold fs-1 text-success">{{ product.price | amount }}</span>
						</p>

						<!-- Détails du produit (contenance, MDD) -->
						<div class="d-flex justify-content-between mb-3">
							<div class="me-1">
								<small>
									<strong>Contenance:</strong>
								</small>
								<span class="fs-6 fw-bold">{{ product.capacity }}
									ml</span>
							</div>
							<div>
								<small>
									<strong>MDD:</strong>
								</small>
								<span class="fs-6 fw-bold">{{ product.MDD | date('Y') }}</span>
							</div>
						</div>

						<!-- Formulaire d'ajout au panier -->
						<form action="{{ path('cart_add', { id: product.id }) }}" method="get" id="addToCartForm">
							<input
							type="hidden" name="id" value="{{ product.id }}">

							<!-- Sélecteur de quantité -->
							<div class="d-flex align-items-center me-2">
								<div class="quantity-selector d-flex align-items-center me-2">
									<button type="button" class="btn btn-outline-secondary" id="decrementBtn">-</button>
									<input type="number" id="quantityInput" name="quantity" value="1" min="1" max="{{ product.stock }}" class="form-control mx-2" style="width: 60px;">
									<button type="button" class="btn btn-outline-secondary" id="incrementBtn">+</button>
								</div>
								<div>
									{% if product.stock > 0 %}
										<button type="submit" class="btn btn-success">Ajouter au panier</button>
									{% else %}
										<p class="text-danger">Temporairement en rupture de stock</p>
									{% endif %}
								</div>
							</div>
						</form>


					</div>

					<!-- Description courte sous la carte -->
					<div class="product-short-description p-3 mt-2">
						<p class="text-muted fs-6">
							Description courte:<br>
							{{ product.introduction }}

						</p>
					</div>
				</div>
			</div>


		</div>
	</form>
	<!-- Accordéon d'informations détaillées -->
	<div class="accordion accordion-flush mt-2 mb-4" id="accordionExample">
		<div class="accordion-item">
			<h2 class="accordion-header" id="headingOne">
				<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
					Description détaillée</button>
			</h2>
			<div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
				<div class="accordion-body">
					<strong>{{ product.name }}</strong>:
					{{ product.description }}</div>
			</div>
		</div>
		<div class="accordion-item">
			<h2 class="accordion-header" id="headingTwo">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
					Indications techniques</button>
			</h2>
			<div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
				<div class="accordion-body">
					<strong>Nom botanique:</strong>
					{{ product.boticalName }}<br>
					<strong>Partie de la plante:</strong>
					{{ product.partofplant }}<br>
					<strong>Méthode d'extraction:</strong>
					{{ product.extractionMethod }}<br>
					<strong>Culture:</strong>
					{{ product.culture }}<br>
					<strong>Contenance:</strong>
					{{ product.capacity }}
					ml<br>
					<strong>Date Maximum de Durabilité:</strong>
					{{ product.MDD | date('Y') }}</div>
			</div>
		</div>
		<div class="accordion-item">
			<h2 class="accordion-header" id="headingThree">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
					Mode d'utilisation et précautions</button>
			</h2>
			<div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
				<div class="accordion-body">
					<strong>Conseils d'utilisation:</strong>
					{{ product.advise }}<br>
					<strong>Précautions:</strong>
					{{ product.precautions }}</div>
			</div>
		</div>
	</div>
	<!-- Produits similaires -->
	<div class="mt-4">
		<h2>Produits similaires</h2>
		<div class="row">

			{% for similarProduct in similarProducts %}
				<div class="col-md-3 ">
					<div class="card">
						<img src="{{ vich_uploader_asset(similarProduct.images[0], 'imageFile') }}" class="card-img-top" alt="{{ similarProduct.name }}">
						<div class="card-body">
							<h5 class="card-title">{{ similarProduct.name }}</h5>
							<p class="card-text">
								<strong>{{ similarProduct.price | amount }}</strong>
							</p>
							<a href="{{ path('product_show', { 'category_slug': product.category.slug, 'slug': product.slug }) }}">
								{{ product.name }}
							</a>
						</div>
					</div>
				</div>
			{% else %}
				<p>Aucun produit similaire trouvé.</p>
			{% endfor %}
		</div>
	</div>
</div>{% endblock %}{% block importmap %}
{# do NOT call parent() #}

{{ importmap(['app', 'shop']) }}{% endblock %}
